<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Events - Event Mate AI</title>
  <link rel="stylesheet" href="dashboard.css" />
  <style>
    body {
      background: #f5fbff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
    }
    .events-wrapper {
      max-width: 950px;
      margin: 40px auto;
      padding: 0 20px;
    }
    .events-title {
      font-size: 24px;
      color: #04345c;
      margin-bottom: 6px;
    }
    .events-subtitle {
      font-size: 14px;
      color: #5b7285;
      margin-bottom: 18px;
    }
    .events-section-title {
      font-size: 18px;
      color: #04345c;
      margin: 14px 0 10px;
    }

    /* Table style for admin catalogue */
    .events-table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      font-size: 13px;
    }
    .events-table thead {
      background: #e6f3ff;
    }
    .events-table th,
    .events-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #dde7f0;
    }
    .events-table th {
      font-weight: 600;
      color: #04345c;
    }
    .events-table tbody tr:hover {
      background: #f5fbff;
    }

    .status-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
    }
    .status-active {
      background: #defce7;
      color: #0a7a33;
    }
    .status-draft {
      background: #fff7e5;
      color: #b7791f;
    }
    .status-cancelled {
      background: #fee2e2;
      color: #b91c1c;
    }

    .action-link {
      font-size: 12px;
      color: #0077c8;
      cursor: pointer;
      text-decoration: underline;
      background: none;
      border: none;
      padding: 0;
    }
    .empty-text {
      font-size: 13px;
      color: #5b7285;
      padding: 10px 0;
    }
  </style>
</head>
<body>
  <!-- floating emojis layer -->
  <div class="floating-emoji-layer" id="floatingEmojiLayer"></div>

  <div class="app-shell">
    <div class="events-wrapper">
      <!-- Main heading -->
      <h1 class="events-title">Manage Events</h1>
      <p class="events-subtitle">
        View all events created in Event Mate AI, check their status and open details or edit screens.
      </p>

      <!-- Event catalogue section -->
      <h2 class="events-section-title">Event Catalogue</h2>
      <div id="catalogueContainer" class="empty-text">
        Loading events...
      </div>
    </div>
  </div>

  <!-- floating emojis script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const emojiLayer = document.getElementById('floatingEmojiLayer');
      if (!emojiLayer) return;

      const EMOJIS = ['ðŸŽ‰','ðŸŽŠ','ðŸŽˆ','ðŸ¥³','ðŸŽ‚','ðŸŽŸï¸','ðŸŽ«','âœ¨','ðŸ¾','ðŸŽµ','ðŸŽ¤','ðŸŽ§','ðŸ“…'];

      function createEmojiBubble() {
        const span = document.createElement('span');
        span.className = 'emoji-bubble';
        span.textContent = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];

        const startLeft = Math.random() * 100;
        const startTop  = Math.random() * 100;
        const dx = (Math.random() * 40 - 20);
        const dy = (Math.random() * 40 - 20);
        const duration = 6 + Math.random() * 6;

        span.style.left = startLeft + 'vw';
        span.style.top  = startTop + 'vh';
        span.style.setProperty('--dx', dx + 'vw');
        span.style.setProperty('--dy', dy + 'vh');
        span.style.animationDuration = duration + 's';

        emojiLayer.appendChild(span);
        setTimeout(() => span.remove(), duration * 1000);
      }

      setInterval(createEmojiBubble, 800);
    });
  </script>

  <script>
    async function loadAdminEvents() {
      const container = document.getElementById('catalogueContainer');
      try {
        const res = await fetch('http://localhost:9098/api/events');
        if (!res.ok) {
          container.textContent = 'Failed to load events.';
          return;
        }

        const events = await res.json();

        if (!events || events.length === 0) {
          container.textContent = 'No events created yet.';
          return;
        }

        // Build table
        const table = document.createElement('table');
        table.className = 'events-table';

        const thead = document.createElement('thead');
        thead.innerHTML = `
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Date &amp; Time</th>
            <th>Venue</th>
            <th>Category</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        `;
        table.appendChild(thead);

        const tbody = document.createElement('tbody');

        events.forEach(e => {
          const tr = document.createElement('tr');

          const dt = e.dateTime ? e.dateTime.replace('T', ' ') : 'Not set';
          const venue = e.venue || 'TBD';
          const category = e.category || '-';
          const status = e.status || 'ACTIVE';

          const statusSpan = document.createElement('span');
          statusSpan.classList.add('status-badge');
          if (status === 'ACTIVE') statusSpan.classList.add('status-active');
          else if (status === 'DRAFT') statusSpan.classList.add('status-draft');
          else if (status === 'CANCELLED') statusSpan.classList.add('status-cancelled');
          statusSpan.textContent = status;

          const tdId = document.createElement('td');
          tdId.textContent = e.id;
          const tdTitle = document.createElement('td');
          tdTitle.textContent = e.title;
          const tdDt = document.createElement('td');
          tdDt.textContent = dt;
          const tdVenue = document.createElement('td');
          tdVenue.textContent = venue;
          const tdCat = document.createElement('td');
          tdCat.textContent = category;
          const tdStatus = document.createElement('td');
          tdStatus.appendChild(statusSpan);

          const tdActions = document.createElement('td');

          const viewBtn = document.createElement('button');
          viewBtn.className = 'action-link';
          viewBtn.textContent = 'View';
          viewBtn.onclick = () => {
            window.location.href = 'user-event-details.html?id=' + e.id;
          };

          const editBtn = document.createElement('button');
          editBtn.className = 'action-link';
          editBtn.textContent = 'Edit';
          editBtn.style.marginLeft = '8px';
          editBtn.onclick = () => {
            window.location.href = 'admin-edit-event.html?id=' + e.id;
          };

          tdActions.appendChild(viewBtn);
          tdActions.appendChild(editBtn);

          tr.appendChild(tdId);
          tr.appendChild(tdTitle);
          tr.appendChild(tdDt);
          tr.appendChild(tdVenue);
          tr.appendChild(tdCat);
          tr.appendChild(tdStatus);
          tr.appendChild(tdActions);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        container.innerHTML = '';
        container.appendChild(table);
      } catch (err) {
        console.error(err);
        container.textContent = 'Error connecting to server.';
      }
    }

    loadAdminEvents();
  </script>
</body>
</html>
